<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>签到奖励</title>
      <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
      <link rel="stylesheet" href="../../css/sigin/bootstrap.min.css">
      <link rel="stylesheet" href="../../css/sigin/style.css">
      <link rel="stylesheet" href="../../css/sigin/qiandao_style.css">

      <style>
          body{

          }
           .headd{
          width: 100%;


          }
           .headd .headd_img{
          width: 100%;
          }
          .prev-img-bg{
          	width: 30px;
          	height: 30px;
          	background-color:rgba(0,0,0,.5);
          	position: absolute;;
          	z-index: 9999;
          	border-radius: 50%;
          	top: 30px;left: 15px;
          }
          .prev-img-bg>img{
          	width: 15px;height: 15px;
          	margin-top: 7px;
          	margin-left: 6px;
          }
      </style>
  </head>
  <body>
    <div class="container">
    	<div class="row">
    		<div class="col-xs-12 clearPadding">
          <div class="headd">
            <img src="http://nn.52juanmi.com/20190425131926362f92142.jpg" class="headd_img"/>
            <div class = 'prev-img-bg'  onclick = "back();">
              <img src="../../image/backw.png" alt="placeholder+image">
            </div>
          </div>

    			<div class="calendar">
    				<div class="calenbox">
    					<div id="calendar"></div>
    				</div>
    				<div class="text-center">
    					<div class="btn btn-qiandao" onClick="signIn()">马上签到</div>
    				</div>
    			</div>
    			<div class="padding10">
    				<!--<p>累计签到天数按距离现在最近的一次累计签到为准</p>-->
    				<!--<p>所有签到统计都只以当月为准</p>-->
    				<div class="font16 pb10 borderb"><strong>签到礼包</strong></div>
    				<div class="libaolist">

    					<div class="clearfix borderb ptb10">
    						<div class="col-xs-9 clearPadding">
    							<div class="media">
    								<a class="media-left pt3" href="javascript:void(0);">
    									<img src="../../image/icon_mibi.png" style="width:30px;height:30px;">
    								</a>
    								<div class="media-body">
    									<div class="">3天礼包（50金币）</div>
    									<div class="text-muted font12">连续签到3天即可领取</div>
    								</div>
    							</div>
    						</div>
    						<div onclick="getReward(1)" class="col-xs-3 clearPadding text-right pt2">
    							<div class="btn btn-lingqu" id="2">领取</div>
    						</div>
    					</div>
    					<div class="clearfix borderb ptb10">
    						<div class="col-xs-9 clearPadding">
    							<div class="media">
    								<a class="media-left pt3" href="javascript:void(0);">
    									<img src="../../image/icon_mibi.png" style="width:30px;height:30px;">
    								</a>
    								<div class="media-body">
    									<div class="">7天礼包（200金币）</div>
    									<div class="text-muted font12">连续签到7天即可领取</div>
    								</div>
    							</div>
    						</div>
    						<div onclick="getReward(2)" class="col-xs-3 clearPadding text-right pt2">
    							<div class="btn btn-lingqu" id="3">领取</div>
    						</div>
    					</div>

    					<div class="clearfix borderb ptb10">
    						<div class="col-xs-9 clearPadding">
    							<div class="media">
    								<a class="media-left pt3" href="javascript:void(0);">
    									<img src="../../image/qian.png" style="width:30px;height:30px;">
    								</a>
    								<div class="media-body">
    									<div class="">15天礼包（3元红包）</div>
    									<div class="text-muted font12">连续签到15天即可领取</div>
    								</div>
    							</div>
    						</div>
    						<div onclick="getReward(3)" class="col-xs-3 clearPadding text-right pt2">
    							<div class="btn btn-lingqu" id="4">领取</div>
    						</div>
    					</div>

              <div class="clearfix borderb ptb10">
                <div class="col-xs-9 clearPadding">
                  <div class="media">
                    <a class="media-left pt3" href="javascript:void(0);">
                      <img src="../../image/qian.png" style="width:30px;height:30px;">
                    </a>
                    <div class="media-body">
                      <div class="">20天礼包（5元红包）</div>
                      <div class="text-muted font12">连续签到20天即可领取</div>
                    </div>
                  </div>
                </div>
                <div onclick="getReward(4)" class="col-xs-3 clearPadding text-right pt2">
                  <div class="btn btn-lingqu" id="4">领取</div>
                </div>
              </div>
    					<div class="clearfix borderb ptb10">
    						<div class="col-xs-9 clearPadding">
    							<div class="media">
    								<a class="media-left pt3" href="javascript:void(0);">
    								    <img src="../../image/qian.png" style="width:30px;height:30px;">
    								</a>
    								<div class="media-body">
    									<div class="">30天礼包（8元红包）</div>
    									<div class="text-muted font12">连续签到30天即可领取</div>
    								</div>
    							</div>
    						</div>
    						<div onclick="getReward(5)" class="col-xs-3 clearPadding text-right pt2">
    							<div class="btn btn-lingqu" id="5">领取</div>
    						</div>
    					</div>

    				</div>
    			</div>
    		</div>
    	</div>
    </div>
    <div class="maskbox"></div>
    <div class="qdbox">
    	<div class="text-center text-green font18"><strong>签到成功！</strong></div>
    	<div class="text-center pt10">获得金币 +20</div>
    	<div class="text-center ptb15"><img src="../../image/icon_mibi.png" style="width:50px; "></div>
    	<div class="text-center" onclick="closediv()"><div class="btn btn-lottery">继续努力</div></div>
    </div>


  </body>
  <script type="text/javascript" src="../../script/api.js"></script>
  <script type="text/javascript" src="../../script/jquery.min.js"></script>
  <script type="text/javascript" src="../../script/common.js"></script>
  <script type="text/javascript" src="../../plugins/calendar.js"></script>
  <script type="text/javascript" src="../../script/usermgr.js"></script>

  <script type="text/javascript">
  var isflag = false;

  function getSigin(){
    sign_list = [{"signDay":""}];
    calUtil.init(sign_list);
    api.showProgress({title: '',  text: '',  modal: true});
    var parms = {
        url:"activec/singinlist/token/"+usermgr.get_usertoken(),
        callback:function(ret){
          api.hideProgress();
          if(ret.flag )
          {
              var myDate = new Date();//获取系统当前时间
              var y = myDate.getFullYear(); //获取当前年份(2位)
              var m =myDate.getMonth()+1; //获取当前月份(0-11,0代表1月)
              if(m>=0 && m <=9){
                  m = '0'+m;
              }
              var d =myDate.getDate(); //获取当前日(1-31)
              if(d>=0 && d <=9){
                  m = '0'+m;
              }
              var ymd = Number(y+""+m+""+d);

              var sign_list =  $api.strToJson(ret.data.signdata);
              //筛选当日的日期
              for (var i = 0; i < sign_list.length; i++) {
                    var info = sign_list[i];
              }


              //var sign_list = [{"signDay":"24","isget":1},{"signDay":"23","isget":1}];
              var initlist = []
              for (var i = 0; i < sign_list.length; i++) {
                    if(sign_list[i].times == ymd){
                       isflag =true;
                    }
                    var datam = sign_list[i].times.substr(4,2);

                    if(parseInt(datam) == parseInt(m)){
                        initlist.push(sign_list[i]);
                    }
              }
              calUtil.init(initlist);
          }
          else {
               sign_list = [{"signDay":""}];
               calUtil.init(sign_list);
          }
        }
    }
    JM_GET(parms);
  }

  function closediv(){
    	$(".maskbox").fadeOut();
      $(".qdbox").fadeOut();

  }

  function  signIn(){
    if(isflag){
      toast2("你今天已经签到过了");
      return;
    }
    api.showProgress({title: '',  text: '',  modal: true});
    var parms = {
        url:"activec/singin/token/"+usermgr.get_usertoken(),
        callback:function(ret){
            if(ret.flag )
            {
                var sign_list =  $api.strToJson(ret.data);
                api.hideProgress();
                calUtil.init(ret.data);
                $(".maskbox").fadeIn();
                $(".qdbox").fadeIn();
                $(".maskbox").height($(document).height());
                isflag = true;
                  usermgr.set_score(usermgr.get_score()+20);
                api.sendEvent({name: 'base_userdata_event'});
            }
            else {
              api.hideProgress();
                toast2("你今天已经签到过了");
            }
        }
    }
    JM_GET(parms);
}

$(".maskbox").click(function(){
	$(".maskbox").fadeOut();
	$(".qdbox").fadeOut();
});


//领取奖励
function getReward(id){
  api.showProgress({title: '',  text: '',  modal: true});
  var parms = {
      url:"activec/getreward/token/"+usermgr.get_usertoken()+"/id/"+id,
      callback:function(ret){
          if(ret.flag )
          {
              var data = ret.data;
              api.hideProgress();
              calUtil.init(data.list);
              if(data.dtype == 1){
                  toast2("恭喜 获得金币:+"+data.dvalue);
                  usermgr.set_score(usermgr.get_score()+data.dvalue);
              }else{
                toast2("恭喜 获得红包:+"+data.dvalue +"元");
                  usermgr.set_umoney(usermgr.get_umoney()+data.dvalue);
              }
              //api.sendEvent({name: 'base_userdata_event',extra:maincolor });
          }
          else {
            api.hideProgress();
              toast2("连续签到日期不够");
          }
      }
  }
  JM_GET(parms);
}

function back(){
  api.closeWin();
}


      apiready = function(){
          $api.fixStatusBar( $api.dom('.headd') );
          if(usermgr.checkLogin()){
              getSigin();
          }

      };
  </script>
  </html>
